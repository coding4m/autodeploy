---
# handlers file for etcd

- name: start firewalld
  service: name=firewalld state=started enabled=yes
  ignore_errors: true

- name: allow etcd ifaces
  command: firewall-cmd --zone=internal --change-interface={{ item }}
  with_items:
    - lo
    - "{{ etcd_peer_iface }}"
    - "{{ etcd_client_iface }}"
  ignore_errors: true

- name: allow etcd traffics
  firewalld: immediate=yes zone=internal port={{ item }}/tcp permanent=true state=enabled
  with_items:
    - "{{ etcd_peer_port }}"
    - "{{ etcd_client_port }}"
  ignore_errors: true

- name: reload firewalld
  command: firewall-cmd --reload

- name: reload systemd
  command: systemctl daemon-reload

- name: restart etcd
  service: name=etcd state=restarted enabled=yes sleep=5
